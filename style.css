/* --- BIẾN MÀU SẮC VÀ FONT --- */
:root {
    --primary-color: #e91e63; /* Hồng đậm chủ đạo */
    --secondary-color: #fce4ec; /* Hồng rất nhạt */
    --accent-color: #ff80ab; /* Hồng vừa */
    --text-color: #333;
    --board-bg: #fff;
    --start-cell: #4caf50; /* Màu ô bắt đầu */
    --finish-cell: #ffc107; /* Màu ô kết thúc */
    --gift-cell: #03a9f4; /* Màu ô quà */
    --font-heading: 'Pacifico', cursive;
    --font-body: 'Nunito', sans-serif;
}

/* --- THIẾT KẾ CƠ BẢN --- */
body {
    font-family: var(--font-body);
    margin: 0;
    background: linear-gradient(135deg, var(--secondary-color) 0%, var(--accent-color) 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
    box-sizing: border-box;
    overflow: hidden;
}

#particles-js {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: 0;
}

.game-container {
    background-color: rgba(255, 255, 255, 0.95);
    border-radius: 25px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    padding: 30px;
    text-align: center;
    max-width: 950px; /* Tăng chiều rộng để chứa bàn cờ mới */
    width: 100%;
    z-index: 1;
    position: relative;
}

h1 {
    font-family: var(--font-heading);
    color: var(--primary-color);
    font-size: 3em;
    margin-bottom: 10px;
}

/* --- BÀN CỜ --- */
.board-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 30px 0;
}

.board {
    display: grid;
    /* Bàn cờ mới 7 cột, 5 hàng */
    grid-template-columns: repeat(7, 85px);
    grid-template-rows: repeat(5, 85px);
    position: relative;
}

.cell {
    width: 80px;
    height: 80px;
    margin: auto; /* Căn ô vào giữa grid cell */
    border-radius: 20px; /* Bo tròn góc */
    background-color: var(--secondary-color);
    border: 3px solid #fff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1); /* Hiệu ứng đổ bóng */
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 0.9em;
    font-weight: bold;
    color: var(--primary-color);
    position: relative;
    transition: transform 0.2s ease;
}

.cell:hover {
    transform: translateY(-3px) scale(1.05);
}

.cell .cell-number {
    font-weight: 900;
    font-size: 1.4em;
    opacity: 0.8;
}

/* --- ĐỊNH VỊ CÁC Ô THEO ĐƯỜNG ĐI MỚI --- */
.cell[data-index="0"] { grid-area: 5 / 1; }
.cell[data-index="1"] { grid-area: 4 / 1; }
.cell[data-index="2"] { grid-area: 3 / 1; }
.cell[data-index="3"] { grid-area: 2 / 1; }
.cell[data-index="4"] { grid-area: 1 / 1; }
.cell[data-index="5"] { grid-area: 1 / 2; }
.cell[data-index="6"] { grid-area: 1 / 3; }
.cell[data-index="7"] { grid-area: 2 / 3; }
.cell[data-index="8"] { grid-area: 3 / 3; }
.cell[data-index="9"] { grid-area: 3 / 4; }
.cell[data-index="10"] { grid-area: 3 / 5; }
.cell[data-index="11"] { grid-area: 2 / 5; }
.cell[data-index="12"] { grid-area: 1 / 5; }
.cell[data-index="13"] { grid-area: 1 / 6; }
.cell[data-index="14"] { grid-area: 1 / 7; }
.cell[data-index="15"] { grid-area: 2 / 7; }
.cell[data-index="16"] { grid-area: 3 / 7; }
.cell[data-index="17"] { grid-area: 4 / 7; }
.cell[data-index="18"] { grid-area: 5 / 7; }
.cell[data-index="19"] { grid-area: 5 / 6; }


/* --- ĐỊNH DẠNG Ô ĐẶC BIỆT --- */
.cell.start { background-color: var(--start-cell); color: white; }
.cell.finish { background-color: var(--finish-cell); color: white; }
.cell.gift { background-color: var(--gift-cell); color: white; }

/* --- QUÂN CỜ VÀ HIỆU ỨNG DI CHUYỂN --- */
.player-token {
    font-size: 2.5em;
    position: absolute;
    width: 85px; /* Bằng kích thước grid cell */
    height: 85px;
    display: flex;
    justify-content: center;
    align-items: center;
    /* Hiệu ứng lướt mượt mà */
    transition: all 0.35s ease-in-out;
    z-index: 10;
    pointer-events: none;
    text-shadow: 0 0 10px rgba(255, 0, 127, 0.7);
}

/* Hiệu ứng tỏa sáng cho ô hiện tại */
.cell.current::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 20px;
    box-shadow: 0 0 15px 5px var(--accent-color);
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { transform: scale(0.95); opacity: 0.7; }
    70% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(0.95); opacity: 0.7; }
}


/* --- KHU VỰC ĐIỀU KHIỂN VÀ XÚC XẮC --- */
/* --- KHU VỰC ĐIỀU KHIỂN VÀ XÚC XẮC --- */
.controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: -80px; /* Sửa ở đây: Giảm từ 20px xuống 15px */
    gap: 20px;        /* Sửa ở đây: Giảm từ 25px xuống 20px */
}

.roll-button {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 15px 35px;
    font-size: 1.4em;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 20px rgba(233, 30, 99, 0.4);
    font-weight: bold;
}

.roll-button:hover:not(:disabled) {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(233, 30, 99, 0.5);
}

.roll-button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
    box-shadow: none;
}

/* --- HIỆU ỨNG XÚC XẮC 3D --- */
.dice {
    width: 60px;
    height: 60px;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 1.5s ease-out;
    transform: translateZ(-30px);
}

.dice-face {
    position: absolute;
    width: 60px;
    height: 60px;
    border: 2px solid var(--primary-color);
    border-radius: 8px;
    background-color: rgba(255, 255, 255, 0.95);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2em;
    color: var(--primary-color);
    font-weight: bold;
}

.face-1 { transform: rotateY(0deg) translateZ(30px); }
.face-2 { transform: rotateY(90deg) translateZ(30px); }
.face-3 { transform: rotateX(90deg) translateZ(30px); }
.face-4 { transform: rotateX(-90deg) translateZ(30px); }
.face-5 { transform: rotateY(-90deg) translateZ(30px); }
.face-6 { transform: rotateY(180deg) translateZ(30px); }

.dice.show-1 { transform: translateZ(-30px) rotateY(0deg); }
.dice.show-2 { transform: translateZ(-30px) rotateY(-90deg); }
.dice.show-3 { transform: translateZ(-30px) rotateX(-90deg); }
.dice.show-4 { transform: translateZ(-30px) rotateX(90deg); }
.dice.show-5 { transform: translateZ(-30px) rotateY(90deg); }
.dice.show-6 { transform: translateZ(-30px) rotateY(-180deg); }

.dice.tumble {
    transform: translateZ(-30px) rotateX(1080deg) rotateY(1080deg) rotateZ(720deg);
}

/* --- MODAL QUÀ TẶNG --- */
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); align-items: center; justify-content: center; }
.modal.show { display: flex; }
.modal-content { background: white; padding: 40px; border-radius: 25px; text-align: center; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.4); max-width: 500px; width: 90%; animation: popIn 0.5s ease-out forwards; }
@keyframes popIn { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.close-button { position: absolute; top: 15px; right: 25px; font-size: 30px; font-weight: bold; cursor: pointer; color: #aaa; transition: color 0.3s; }
.close-button:hover { color: var(--primary-color); }
.modal-icon { font-size: 4em; animation: tada 1.5s infinite; }
.modal-content h2 { font-family: var(--font-heading); color: var(--primary-color); font-size: 2.2em; }
.modal-content p { font-size: 1.2em; line-height: 1.6; color: #555; }
@keyframes tada { from { transform: scale3d(1, 1, 1); } 10%, 20% { transform: scale3d(.9, .9, .9) rotate3d(0, 0, 1, -3deg); } 30%, 50%, 70%, 90% { transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg); } 40%, 60%, 80% { transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg); } to { transform: scale3d(1, 1, 1); } }

/* --- CSS CHO PHOTOBOOTH --- */
.photobooth-container {
    background: #fff;
    border-radius: 25px;
    padding: 30px;
    width: 90%;
    max-width: 800px;
    text-align: center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    animation: popIn 0.5s ease-out;
}

#cameraScreen {
    position: relative;
    width: 100%;
    max-width: 640px;
    margin: 0 auto;
    border-radius: 15px;
    overflow: hidden;
    border: 5px solid var(--primary-color);
}

#photoboothVideo {
    width: 100%;
    height: auto;
    display: block;
    transform: scaleX(-1); /* Lật video giống như gương soi */
}

.countdown-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 8em;
    font-weight: bold;
    color: white;
    background-color: rgba(0,0,0,0.3);
    text-shadow: 0 0 20px black;
    opacity: 0;
    transition: opacity 0.3s;
}

.countdown-overlay.show {
    opacity: 1;
}

.instructions {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.5);
    color: white;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 1.2em;
}

/* Màn hình xem lại */
#reviewScreen h2 {
    font-family: var(--font-heading);
    color: var(--primary-color);
}

.photo-previews {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin: 20px 0;
    flex-wrap: wrap;
}

.preview-item {
    position: relative;
}

.preview-item img {
    width: 150px;
    height: 112px; /* Tỷ lệ 4:3 */
    object-fit: cover;
    border: 3px solid var(--accent-color);
    border-radius: 10px;
}

.preview-item .retake-button {
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(255, 0, 0, 0.7);
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 1.2em;
    cursor: pointer;
    line-height: 30px;
}

.review-buttons button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 12px 25px;
    font-size: 1.1em;
    border-radius: 30px;
    cursor: pointer;
    margin: 10px;
    transition: background-color 0.3s;
}

.review-buttons button:hover {
    background-color: var(--button-hover-bg, #e0326d);
}


/* Màn hình kết quả cuối cùng */
.final-photo-wrapper {
    display: flex;
    gap: 20px;
    align-items: center;
    margin: 20px 0;
}

.photo-frame {
    padding: 15px;
    background: linear-gradient(135deg, #ff85a2, #ffc0cb);
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    flex-shrink: 0;
}

.photo-frame img {
    display: block;
    width: 300px; /* Chiều rộng ảnh cuối cùng */
    border: 5px solid white;
}

.final-message {
    text-align: left;
    color: #555;
}

.final-message h3 {
    font-family: var(--font-heading);
    color: var(--primary-color);
    font-size: 2em;
    margin-top: 0;
}

#printBtn, #closePhotoboothBtn {
    background-color: var(--start-cell);
    color: white;
    border: none;
    padding: 12px 25px;
    font-size: 1.1em;
    border-radius: 30px;
    cursor: pointer;
    margin: 10px;
}

#closePhotoboothBtn {
    background-color: #777;
}

/* Canvas ẩn dùng để xử lý ảnh */
.hidden-canvas {
    display: none;
}
.photobooth-title {
    font-family: var(--font-heading);
    color: var(--primary-color);
    font-size: 2.5em;
}
.photobooth-button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 15px 30px;
    font-size: 1.2em;
    font-weight: bold;
    border-radius: 50px;
    cursor: pointer;
    margin: 10px;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
}
.photobooth-button:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(233, 30, 99, 0.5);
}
.photobooth-button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
    box-shadow: none;
}

.photobooth-button.secondary {
    background-color: #777;
    box-shadow: 0 5px 15px rgba(0,0,0, 0.2);
}
#startScreen {
    padding: 20px;
}

#startScreen p {
    font-size: 1.2em;
    color: #555;
    margin-bottom: 20px;
}
.video-wrapper {
    position: relative;
    width: 100%;
    max-width: 640px;
    margin: 0 auto 15px auto; /* Thêm margin dưới cho nút bấm */
    border-radius: 15px;
    overflow: hidden;
    border: 5px solid var(--primary-color);
}
.flash-effect {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: white;
    opacity: 0;
    pointer-events: none; /* Cho phép click xuyên qua */
}

.flash-effect.flash {
    animation: flash 0.5s ease-out;
}

@keyframes flash {
    0% { opacity: 0; }
    50% { opacity: 0.8; }
    100% { opacity: 0; }
}

/* Khung ảnh kết quả */
.photo-frame {
    padding: 15px;
    /* Giữ nguyên họa tiết nền hồng nhạt */
    background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffc0cb' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E");
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    /* Bỏ flex-shrink để canvas có kích thước tự do hơn */
}

/* Canvas cuối cùng sẽ thay thế thẻ img */
#finalCanvas {
    display: block;
    width: 300px; /* Chiều rộng cố định cho khung ảnh */
    height: auto; /* Chiều cao tự động để khớp với nội dung */
    border: 5px solid white;
    box-sizing: border-box; /* Đảm bảo padding/border không làm tăng kích thước */
}